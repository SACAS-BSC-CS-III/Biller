<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rithika Mobiles — Bill Printer</title>

<!-- Poppins font for whole site -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --accent:#111827;
    --muted:#6b7280;
    --paper-bg:#fff;
    --max-w:1000px;
  }
  *{box-sizing:border-box}
  body{
    font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    margin:18px;
    background:#f3f4f6;
    color:var(--accent);
  }
  .container{max-width:var(--max-w);margin:0 auto;background:var(--paper-bg);padding:18px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);}
  h1.page-title{margin:0 0 12px 0;font-size:20px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px}
  button{padding:8px 12px;border-radius:6px;border:1px solid #e6e9ee;background:white;cursor:pointer;font-weight:600}
  button.primary{background:var(--accent);color:white;border-color:transparent}
  .grid{display:grid;grid-template-columns:1fr 380px;gap:14px;align-items:start}
  .card{background:#fff;padding:12px;border-radius:8px;border:1px solid #eef2f7}
  label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
  input[type=text], input[type=number]{
    width:100%;padding:8px;border-radius:6px;border:1px solid #e6e9ee;font-size:14px;margin-bottom:10px;
    outline:none;
  }
  .items-table, .print-table{width:100%;border-collapse:collapse}
  .items-table th, .items-table td, .print-table th, .print-table td {padding:8px;border:1px solid #e6e9ee;text-align:left}
  .items-table th{background:#f8fafc;font-weight:600}
  .right{text-align:right}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:12px}
  .center{text-align:center}

  /* Invoice preview (hidden on-screen; printed only) */
  .invoice-preview{
    display:none; /* hide on screen */
    margin-top:14px;padding:14px;background:#fff;border-radius:6px;border:1px solid #eef2f7
  }
  .inv-header{display:block;text-align:center;margin-bottom:6px}
  .inv-header h2{margin:0;font-size:22px;font-weight:700}
  .inv-header .addr{font-size:13px;margin-top:4px;color:var(--muted)}
  .inv-meta{display:flex;justify-content:space-between;margin-top:8px;font-size:13px;color:var(--muted)}
  .inv-customer{margin-top:10px;display:flex;justify-content:space-between;gap:12px}
  .inv-customer div{font-size:14px}
  .total-row{font-weight:700;font-size:16px}
  .footer-note{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}

  /* Print-specific styles */
  @media print {
  body { background:white }
  .controls, .no-print { display: none !important; }
  .invoice-preview { 
    display: block !important; 
    font-size: 12px;    
    line-height: 1.2;   
  }

  .container { box-shadow:none; border-radius:0; margin:0; padding:0 }

  @page { size: A5 portrait; margin: 6mm; }
  .invoice-preview .print-table th,
  .invoice-preview .print-table td { 
    border:1px solid #333; 
    padding:6px;
    font-size: 14px;
  }
  .inv-header h2 { 
    font-size:40px; 
    font-weight:700; 
    text-align:center; 
    padding-bottom: 5px;
  }
  .inv-header .addr { font-size: 11px; padding-bottom: 5px;}
  .inv-meta, .inv-customer { font-size: 11px; }
  .footer-note { font-size: 10px; margin-top:8px; }
}




  /* Small responsive */
  @media (max-width:820px){
    .grid{grid-template-columns:1fr; }
  }

  /* helper */
  .flex{display:flex;gap:8px;align-items:center}
  .sno{width:40px;text-align:center}
  .col-qty{width:80px;text-align:right}
  .col-rate{width:120px;text-align:right}
  .col-amt{width:120px;text-align:right}
  .remove-btn{background:#fff;color:#ff4444;border:1px solid #ffdede;padding:4px 8px;border-radius:6px;cursor:pointer}
</style>
</head>
<body>
  <div class="container">
    <div class="controls no-print">
      <button id="printBtn" onclick="doPrint()" class="primary">Print</button>
      <button onclick="resetAll()" id="resetBtn">Reset</button>
      <button onclick="focusParticular()">Add Item (focus)</button>
    </div>

    <div class="grid">
      <!-- Left: Form to add customer and items -->
      <div>
        <div class="card no-print">
          <label>Customer Name</label>
          <input type="text" id="custNameInput" placeholder="Enter customer name" autocomplete="off">

          <label>Customer Mobile</label>
          <input type="text" id="custMobileInput" placeholder="Enter mobile number" autocomplete="off">

          <hr style="border:none;border-top:1px dashed #eef2f7;margin:12px 0">

          <label><strong>Add Particular</strong></label>
          <input type="text" id="particularInput" placeholder="Particulars (item name)" />

          <div style="display:flex;gap:8px">
            <input type="number" id="rateInput" placeholder="Rate (optional)" min="0" step="0.01" />
            <input type="number" id="qtyInput" placeholder="Qty (optional)" min="0" step="1" />
            <input type="number" id="amountInput" placeholder="Amount (optional)" min="0" step="0.01" />
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button onclick="addItem()">Add Particular</button>
            <button onclick="addItem(true)">Add & Clear</button>
            <button onclick="clearParticular()" class="no-print">Clear fields</button>
          </div>

          <p class="muted small" style="margin-top:10px">
            Notes: If Rate and Qty are provided, Amount is calculated automatically. Otherwise enter Amount manually.
          </p>
        </div>

        <!-- On-screen items table: HIDDEN in print via .no-print -->
        <div class="card no-print" style="margin-top:12px">
          <table class="items-table" id="onScreenItems">
            <thead>
              <tr>
                <th class="sno">S.No</th>
                <th>Particulars</th>
                <th class="col-rate">Rate</th>
                <th class="col-qty">Qty</th>
                <th class="col-amt">Amount</th>
                <th style="width:80px">Action</th>
              </tr>
            </thead>
            <tbody id="itemsBody">
              <!-- populated by JS -->
            </tbody>
            <tfoot>
              <tr>
                <td colspan="4" class="right muted">Total</td>
                <td class="col-amt" id="onScreenTotal">₹0.00</td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <!-- Right: Invoice preview (used only for printing) - hidden on screen -->
      <div>
        <div class="invoice-preview" id="invoicePreview" aria-hidden="true">
          <div class="inv-header">
            <h2>Rithika Mobiles</h2>
            <div class="addr muted">No.10/103, Pattur Main Road, Chinnapanicheri, Paraniputhur, Chennai - 600122.</div>
            <div class="addr muted">Mobile: 95144 74999</div>
          </div>

          <div class="inv-meta">
            <div id="metaLeft" class="muted"></div>
            <div id="metaRight" class="muted"></div>
          </div>

          <div class="inv-customer" style="margin-top:8px">
            <div><strong>Customer:</strong> <span id="previewCustomer">-</span></div>
            <div><strong>Mobile:</strong> <span id="previewCustMobile">-</span></div>
          </div>

          <div style="margin-top:12px">
            <table class="print-table" id="printTable" aria-hidden="true">
              <thead>
                <tr>
                  <th class="sno">S.No</th>
                  <th>Particulars</th>
                  <th class="col-rate">Rate</th>
                  <th class="col-qty">Qty</th>
                  <th class="col-amt">Amount</th>
                </tr>
              </thead>
              <tbody id="printBody">
                <!-- populated by JS -->
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="4" class="right total-row">Total to be paid</td>
                  <td class="col-amt total-row" id="printTotal">₹0.00</td>
                </tr>
              </tfoot>
            </table>
          </div>

          <div class="footer-note">This is Computer Generated Bill. Doesn't Require any seal and Signature</div>
        </div>
      </div>
    </div>
  </div>

<script>
  // Data store
  let items = [];

  // Helpers
  function formatCurrency(v){
    if (v === null || v === undefined || isNaN(Number(v))) return "₹0.00";
    return "₹" + Number(v).toLocaleString('en-IN', {minimumFractionDigits:2, maximumFractionDigits:2});
  }

  function updatePreviewMeta() {
    const now = new Date();
    const dateStr = now.toLocaleDateString('en-IN');
    const timeStr = now.toLocaleTimeString('en-IN', {hour: '2-digit', minute:'2-digit', second:'2-digit'});
    // Only show date/time (no invoice number as requested)
    document.getElementById('metaLeft').textContent = `Date: ${dateStr} ${timeStr}`;
    document.getElementById('metaRight').textContent = ''; // intentionally blank (no invoice number)
  }

  function renderItems() {
    const onBody = document.getElementById('itemsBody');
    const printBody = document.getElementById('printBody');
    onBody.innerHTML = '';
    printBody.innerHTML = '';
    let total = 0;
    items.forEach((it, idx) => {
      const sno = idx + 1;
      // on-screen row
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="center">${sno}</td>
        <td><strong>${escapeHtml(it.particular)}</strong><div class="muted small">${escapeHtml(it.desc||'')}</div></td>
        <td class="col-rate right">${it.rate != null ? formatCurrency(it.rate) : '-'}</td>
        <td class="col-qty right">${it.qty != null ? it.qty : '-'}</td>
        <td class="col-amt right">${formatCurrency(it.amount)}</td>
        <td class="center"><button class="remove-btn" onclick="removeItem(${idx})">Delete</button></td>
      `;
      onBody.appendChild(tr);

      // print row (built for printing only)
      const pr = document.createElement('tr');
      pr.innerHTML = `
        <td class="center">${sno}</td>
        <td>${escapeHtml(it.particular)}</td>
        <td class="col-rate right">${it.rate != null ? formatCurrency(it.rate) : '-'}</td>
        <td class="col-qty right">${it.qty != null ? it.qty : '-'}</td>
        <td class="col-amt right">${formatCurrency(it.amount)}</td>
      `;
      printBody.appendChild(pr);

      total += Number(it.amount || 0);
    });

    document.getElementById('onScreenTotal').textContent = formatCurrency(total);
    document.getElementById('printTotal').textContent = formatCurrency(total);
    updatePreviewMeta();
  }

  function escapeHtml(s){
    if (s === undefined || s === null) return '';
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  // Add item
  function addItem(clearAfter=false) {
    const particular = document.getElementById('particularInput').value.trim();
    const rateRaw = document.getElementById('rateInput').value;
    const qtyRaw = document.getElementById('qtyInput').value;
    const amountRaw = document.getElementById('amountInput').value;

    if (!particular) {
      alert('Please enter Particulars (item name).');
      return;
    }

    // normalize inputs
    const rate = (rateRaw === '' || rateRaw === null) ? null : Number(rateRaw);
    const qty = (qtyRaw === '' || qtyRaw === null) ? null : Number(qtyRaw);
    const amountManual = (amountRaw === '' || amountRaw === null) ? null : Number(amountRaw);

    let amountFinal = null;

    // If both rate and qty provided => calc
    if (rate != null && qty != null) {
      amountFinal = rate * qty;
    } else if (amountManual != null) {
      // amount explicitly provided by user
      amountFinal = amountManual;
    } else if (rate != null && (qty == null || qty === 0)) {
      // assume qty = 1 if qty missing or zero
      amountFinal = rate * 1;
    } else if (qty != null && rate == null) {
      // qty given but rate missing and amount not provided -> cannot calc
      alert('Rate is missing. Provide Rate or Amount to calculate.');
      return;
    } else {
      // nothing provided to compute amount
      alert('Either provide Rate & Qty or specify Amount manually.');
      return;
    }

    // ensure final numbers are valid
    if (isNaN(amountFinal)) {
      alert('Calculated amount is not a valid number. Check Rate/Qty/Amount inputs.');
      return;
    }

    items.push({
      particular: particular,
      desc: '', // reserved
      rate: rate != null ? rate : null,
      qty: qty != null ? qty : null,
      amount: Number(amountFinal)
    });

    if (clearAfter) {
      document.getElementById('particularInput').value = '';
      document.getElementById('rateInput').value = '';
      document.getElementById('qtyInput').value = '';
      document.getElementById('amountInput').value = '';
      document.getElementById('particularInput').focus();
    } else {
      // leave values so user can quickly add similar
    }

    renderItems();
  }

  function removeItem(idx) {
    if (!confirm('Delete this particular?')) return;
    items.splice(idx,1);
    renderItems();
  }

  function clearParticular() {
    document.getElementById('particularInput').value = '';
    document.getElementById('rateInput').value = '';
    document.getElementById('qtyInput').value = '';
    document.getElementById('amountInput').value = '';
    document.getElementById('particularInput').focus();
  }

  // Print behavior: update preview customer info and then call print.
  function doPrint() {
    const cname = document.getElementById('custNameInput').value.trim() || '-';
    const cmobile = document.getElementById('custMobileInput').value.trim() || '-';
    document.getElementById('previewCustomer').textContent = cname;
    document.getElementById('previewCustMobile').textContent = cmobile;

    // ensure latest meta (date/time) & print body are updated just before print
    renderItems();
    updatePreviewMeta();

    // Scroll to top so print picks up top of invoice (some browsers)
    window.scrollTo(0,0);

    // Trigger print. invoice-preview is hidden on screen but becomes visible during print.
    window.print();
  }

  // Reset all (does not refresh page)
  function resetAll() {
    if (!confirm('Reset invoice data? This will clear items and customer info.')) return;
    items = [];
    document.getElementById('custNameInput').value = '';
    document.getElementById('custMobileInput').value = '';
    clearParticular();
    renderItems();
  }

  function focusParticular(){
    document.getElementById('particularInput').focus();
  }

  // init
  document.addEventListener('DOMContentLoaded', function(){
    renderItems();

    // Enter key quick-add
    ['particularInput','rateInput','qtyInput','amountInput'].forEach(id=>{
      document.getElementById(id).addEventListener('keydown', function(e){
        if (e.key === 'Enter'){
          e.preventDefault();
          addItem(true);
        }
      });
    });
  });
</script>
</body>
</html>

